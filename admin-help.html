<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Help Desk Admin</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
h2 { text-align: center; }
table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}
th, td {
  border: 1px solid #ccc;
  padding: 10px;
  text-align: left;
}
th {
  background: #007bff;
  color: white;
}
button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.solve { background: green; color: white; }
.delete { background: red; color: white; }
.logout {
  float: right;
  background: #444;
  color: white;
  margin-bottom: 10px;
}
.pending { color: orange; font-weight: bold; }
.done { color: green; font-weight: bold; }
</style>
</head>
<body>

<button class="logout" onclick="logout()">Logout</button>
<h2>Help Desk - Admin Dashboard</h2>

<table id="ticketTable">
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Email</th>
    <th>Issue</th>
    <th>Status</th>
    <th>Date</th>
    <th>Actions</th>
  </tr>
</table>

<script>
// ✅ Redirect if owner not logged in
if (localStorage.getItem('isOwnerLoggedIn') !== 'true') {
  alert("Access denied! Please log in as Owner first.");
  window.location.href = 'login.html';
}

// ✅ Load tickets
function loadTickets() {
  const tickets = JSON.parse(localStorage.getItem('helpTickets')) || [];
  const table = document.getElementById('ticketTable');
  table.querySelectorAll("tr:not(:first-child)").forEach(tr => tr.remove());

  tickets.forEach(t => {
    const row = table.insertRow();
    row.innerHTML = `
      <td>${t.id}</td>
      <td>${t.name}</td>
      <td>${t.email}</td>
      <td>${t.issue}</td>
      <td class="${t.status === 'Pending' ? 'pending' : 'done'}">${t.status}</td>
      <td>${t.date}</td>
      <td>
        <button class="solve" onclick="markSolved(${t.id})">Mark Solved</button>
        <button class="delete" onclick="deleteTicket(${t.id})">Delete</button>
      </td>
    `;
  });
}

// ✅ Mark ticket as solved
function markSolved(id) {
  const tickets = JSON.parse(localStorage.getItem('helpTickets')) || [];
  const ticket = tickets.find(t => t.id === id);
  if (ticket) ticket.status = 'Solved';
  localStorage.setItem('helpTickets', JSON.stringify(tickets));
  loadTickets();
}

// ✅ Delete ticket
function deleteTicket(id) {
  const tickets = JSON.parse(localStorage.getItem('helpTickets')) || [];
  const newTickets = tickets.filter(t => t.id !== id);
  localStorage.setItem('helpTickets', JSON.stringify(newTickets));
  loadTickets();
}

// ✅ Proper logout
function logout() {
  localStorage.removeItem('isOwnerLoggedIn');
  window.location.href = 'login.html';
}

loadTickets();
</script>
</body>
</html>
